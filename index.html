<meta charset=utf-8>
<title>TCI online</title>

<link rel=stylesheet href=http://tci.anthropedia.org/static/css/app.css>
<style>
  @import url('https://fonts.googleapis.com/css?family=Open+Sans');
  * {
    box-sizing: border-box;
  }
  body {
    font-family: "Open Sans", Arial, Helvetica, sans-serif;
  }
  html {
    border-top: 5px solid #c9ba97;
    border-bottom: 50px solid #c9ba97;
    margin: 0;
    padding: 0;
    height: 100%;
  }
  html::after {
    content: "";
    background: url(/images/birds1.svg) no-repeat;
    opacity: .1;
    top: 1%;
    right: 1%;
    position: absolute;
    z-index: -1;
    height: 100%;
    width: 200px;
  }

  header h1,
  header h2 {
    font-weight: 100;
    text-transform: uppercase;
    margin: .2em;
    line-height: .7em;
    font-size: 1.5em;
  }
  header h2 {
    font-size: .7em;
  }

  main {
    background-color: rgba(255,255,255,.88);
    border: 1px solid #bbb;
    padding: 20px;
  }

  #question {
    position: relative;
    min-height: 100px;
  }

  #legend {
    display: flex;
  }
  #legend li {
    display: block;
    width: 20%;
    min-height: 100px;
    text-align: center;
    border: 1px solid #999;
    padding: 1em;
    line-height: 1.4em;
  }
  #legend li:not(:first-of-type) {
    border-left: none;
  }
  #legend li span {
    display: block;
    text-align: center;
    width: 35px;
    height: 32px;
    padding: 4px;
    margin: 0 auto;
    font-size: 1.1em;
  }

  #question h1 {
    font-family: inherit;
    display: inline-block;
    width: calc(100% - 240px);
    font-weight: normal;
    font-size: 1.5em;
    padding-right: 1em;
  }

  #answers {
    display: inline-block;
    width: 235px;
    vertical-align: top;
    margin-top: 12px;
  }
  #answers input[type=radio] {
    display: none;
  }

  #answers label,
  #legend li span {
    text-align: center;
    vertical-align: middle;
    background-color: lightblue;
    font-weight: bold;
    text-shadow: 1px 1px 1px #00000099;
    color: white;
  }
  #answers label {
    display: inline-block;
    padding: 10px 15px;
    transition: background-color .5s;
    font-size: 1.3em;
  }
  #answers label:nth-of-type(1),
  #legend li:nth-of-type(1) span {
    background-color: #9df;
  }
  #answers label:nth-of-type(2),
  #legend li:nth-of-type(2) span {
    background-color: #8ce;
  }
  #answers label:nth-of-type(3),
  #legend li:nth-of-type(3) span {
    background-color: #7bd;
  }
  #answers label:nth-of-type(4),
  #legend li:nth-of-type(4) span {
    background-color: #6ac;
  }
  #answers label:nth-of-type(5),
  #legend li:nth-of-type(5) span {
    background-color: #59b;
  }
  #answers label:hover {
    background-color: #4b5;
  }
  #counter {
    position: absolute;
    top: 70px;
    right: 10px;
    font-size: .9em;
    text-align: right;
    font-style: italic;
  }
  [hidden] {
    display: none !important;
  }
</style>


<header>
  <h1>
    <a href="/">
      <h1>TCI</h1>
      <h2>Temperament & Character Inventory</h2>
    </a>
  </h1>
</header>

<main>
<ul id=legend>
  <li><span>1</span>Absolutely false</li>
  <li><span>2</span>Probably or mostly false</li>
  <li><span>3</span>Neither true nor false, or about the same</li>
  <li><span>4</span>Probably or mostly true</li>
  <li><span>5</span>Absolutely true</li>
</ul>

<section id=question page hidden>
  <h1></h1>
  <form method=post id=answers>
    <label for=answer-1 title="Absolutely false"><input id=answer-1 type=radio name=answer value=1>1</label>
    <label for=answer-2 title="Probably or mostly false"><input id=answer-2 type=radio name=answer value=2>2</label>
    <label for=answer-3 title="Neither true nor false, or about the same"><input id=answer-3 type=radio name=answer value=3>3</label>
    <label for=answer-4 title="Probably or mostly true"><input id=answer-4 type=radio name=answer value=4>4</label>
    <label for=answer-5 title="Absolutely true"><input id=answer-5 type=radio name=answer value=5>5</label>
  </form>
  <div id=counter></div>
</section>

<section id=end page hidden>
  <p>Your have completed this test.</p>
  <p>Please refer to your provider to know more about your results.</p>
</section>
</main>

<script>
  const apiURL = 'http://api.tci.anthropedia.org'
  const container = document.querySelector('#question')
  const titleTag = container.querySelector('h1')
  const counterTag = container.querySelector('#counter')
  let questions = []
  let index = 0
  let startTime = 0
  const answers = []
  const timers = []
  const clickDelay = 500

  let form = container.querySelector('form')
  // Form submit
  form.addEventListener('next', event => {
    answers[index] = Number(event.target.answer.value)
    timers[index] = (new Date()).getTime() - startTime
    index++
    step(index)
  })

  // Click answer to submit
  ;[].map.call(document.querySelectorAll('#answers [type=radio]'), (answer, i) => {
    answer.addEventListener('change', event => {
      if((new Date()).getTime() - startTime < clickDelay) {
        form.reset()
        return
      }
      form.dispatchEvent(new Event('next'))
    })
  })

  function step(index) {
    // prevent exceeds
    if(index >= questions.length) {
      end()
    }
    // reset counter and display
    startTime = (new Date()).getTime()
    titleTag.textContent = questions[index]
    form.reset()
    counterTag.textContent = `${index+1}/${questions.length}`
  }

  function end() {
    showPage('end')
  }

  function showPage(id) {
    document.querySelector('[page]').setAttribute('hidden', true)
    document.querySelector('[page]#'+id).removeAttribute('hidden')
  }

  function ready() {
    step(index)
    showPage('question')
  }

  fetch(`${apiURL}/questions`)
  .then(response => response.json())
  .then(questionsResponse => {
    questions = questionsResponse
    ready()
  })
</script>